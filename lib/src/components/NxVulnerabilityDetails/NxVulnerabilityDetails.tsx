/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
import React, { FunctionComponent } from 'react';
import { any, eqBy, toLower } from 'ramda';

import MarkdownDetail from './details/MarkdownDetail';
import IssueDetail from './details/IssueDetail';
import SeverityDetail from './details/SeverityDetail';
import WeaknessDetail from './details/WeaknessDetail';
import SourceDetail from './details/SourceDetail';
import CategoriesDetail from './details/CategoriesDetail';
import DescriptionDetail from './details/DescriptionDetail';
import AdvisoriesDetail from './details/AdvisoriesDetail';
import CVSSDetail from './details/CVSSDetail';
import RootCauseDetail from './details/RootCauseDetail';
import './NxVulnerabilityDetails.scss';
import { Props, propTypes } from './types';
export { Props, vulnerabilityDetailsPropType } from './types';

const MALICIOUS_CODE: string = 'malicious_code'; // eslint-disable-line @typescript-eslint/no-inferrable-types

const NxVulnerabilityDetails: FunctionComponent<Props> = function NxVulnerabilityDetails({vulnerabilityDetails}) {
  const categories = vulnerabilityDetails.categories || [],
      hasMaliciousCodeCategory = any(eqBy(toLower, MALICIOUS_CODE), categories),
      maliciousCodeWarning = hasMaliciousCodeCategory ? 'Malicious Code' : null;

  return (
    <div className="nx-vulnerability-details">
      <h2 className="nx-h2">
        {vulnerabilityDetails.identifier}
      </h2>
      <div className="nx-grid-row">
        <div className="nx-grid-col nx-grid-col--25">
          <IssueDetail identifier={vulnerabilityDetails.identifier}
                       vulnerabilityLink={vulnerabilityDetails.vulnerabilityLink}/>
          <SeverityDetail mainSeverity={vulnerabilityDetails.mainSeverity}
                          severityScores={vulnerabilityDetails.severityScores}/>
          <WeaknessDetail weakness={vulnerabilityDetails.weakness}/>
          <SourceDetail source={vulnerabilityDetails.source}/>
          <CategoriesDetail categories={vulnerabilityDetails.categories}/>
        </div>
        <div className="nx-grid-col nx-grid-col--vuln-details">
          <DescriptionDetail source={vulnerabilityDetails.source}
                             description={vulnerabilityDetails.description}/>
          <MarkdownDetail title="Explanation"
                          warning={maliciousCodeWarning}
                          markdown={vulnerabilityDetails.explanationMarkdown}
                          componentSpecificMarkdown={vulnerabilityDetails.componentExplanationMarkdown}/>
          <MarkdownDetail title="Detection"
                          markdown={vulnerabilityDetails.detectionMarkdown}
                          componentSpecificMarkdown={vulnerabilityDetails.componentDetectionMarkdown}/>
          <MarkdownDetail title="Recommendation"
                          markdown={vulnerabilityDetails.recommendationMarkdown}
                          componentSpecificMarkdown={vulnerabilityDetails.componentRecommendationMarkdown}/>
          <RootCauseDetail rootCauses={vulnerabilityDetails.rootCauses}/>
          <AdvisoriesDetail advisories={vulnerabilityDetails.advisories}/>
          <CVSSDetail severity={vulnerabilityDetails.mainSeverity}/>
        </div>
      </div>
    </div>
  );
};

NxVulnerabilityDetails.propTypes = propTypes;

export default NxVulnerabilityDetails;
